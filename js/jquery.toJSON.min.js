(function(e){e.fn.toJSON=function(t){t=e.extend({},t);var n=this,r={},i={},s={validate:/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,key:/[a-zA-Z0-9_]+|(?=\[\])/g,push:/^$/,fixed:/^\d+$/,named:/^[a-zA-Z0-9_]+$/};this.build=function(e,t,n){e[t]=n;return e};this.push_counter=function(e,t){if(i[e]===undefined){i[e]=0}if(t===undefined){return i[e]++}else if(t!==undefined&&t>i[e]){return i[e]=++t}};e.each(e(this).serializeArray(),function(){if(!s.validate.test(this.name)){return}var t,i=this.name.match(s.key),o=this.value,u=this.name;while((t=i.pop())!==undefined){u=u.replace(new RegExp("\\["+t+"\\]$"),"");if(t.match(s.push)){o=n.build([],n.push_counter(u),o)}else if(t.match(s.fixed)){n.push_counter(u,t);o=n.build([],t,o)}else if(t.match(s.named)){o=n.build({},t,o)}}r=e.extend(true,r,o)});return r}})(jQuery)
